<!-- Mobile Collapsed Player -->
<div class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-2 z-50"
    [class.h-16]="!isExpanded">
  <!-- Collapsed view content -->
  <div class="flex items-center justify-between">
    <div class="flex items-center flex-1 min-w-0" (click)="toggleExpandedView($event)">
      <img [src]="song.imageUrl" (error)="handleImageError($event)" alt="Album cover" class="w-12 h-12 object-cover rounded-md mr-3">
      <div class="truncate">
        <h4 class="text-gray-900 dark:text-white font-semibold truncate">{{song.title}}</h4>
        <p class="text-gray-500 dark:text-gray-400 text-sm truncate">{{song.artist}}</p>
      </div>
    </div>
    <div class="flex items-center space-x-3">
      <button (click)="rewind15($event)" class="text-gray-900 dark:text-white">
        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
          <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
          <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
          <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M11.324 1.67511C11.4489 1.41526 11.7117 1.25 12 1.25C12.7353 1.25 13.4541 1.32394 14.1492 1.46503C19.0563 2.46112 22.75 6.79837 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12C1.25 7.59065 3.90459 3.80298 7.69972 2.14482C8.07929 1.97898 8.52143 2.15224 8.68726 2.53181C8.8531 2.91137 8.67984 3.35351 8.30028 3.51935C5.03179 4.94742 2.75 8.20808 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 7.84953 18.5158 4.33622 14.75 3.16544V4.5C14.75 4.81852 14.5488 5.10229 14.2483 5.20772C13.9477 5.31315 13.6133 5.21724 13.4143 4.96852L11.4143 2.46852C11.2342 2.24339 11.1991 1.93496 11.324 1.67511Z"/>
        </svg>
      </button>
      <button (click)="togglePlay($event)" class="text-gray-900 dark:text-white">
        <ng-container *ngIf="!isPlaying; else pauseIconSmall">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </ng-container>
        <ng-template #pauseIconSmall>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </ng-template>
      </button>
      <button (click)="forward15($event)" class="text-gray-900 dark:text-white">
        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
          <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
          <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
          <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M12.676 1.67511C12.5511 1.41526 12.2883 1.25 12 1.25C11.2647 1.25 10.5459 1.32394 9.8508 1.46503C4.94367 2.46112 1.25 6.79837 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 7.59065 20.0954 3.80298 16.3003 2.14482C15.9207 1.97898 15.4786 2.15224 15.3127 2.53181C15.1469 2.91137 15.3202 3.35351 15.6997 3.51935C18.9682 4.94742 21.25 8.20808 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 7.84953 5.48421 4.33622 9.25 3.16544V4.5C9.25 4.81852 9.45118 5.10229 9.75175 5.20772C10.0523 5.31315 10.3867 5.21724 10.5857 4.96852L12.5857 2.46852C12.7658 2.24339 12.8009 1.93496 12.676 1.67511Z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Progress bar for collapsed view -->
  <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-200 dark:bg-gray-800" *ngIf="!isExpanded">
    <div class="h-full bg-indigo-500 dark:bg-green-500" [style.width.%]="(currentTime / duration) * 100"></div>
  </div>
</div>

<!-- Mobile Expanded View Modal -->
<div *ngIf="isExpanded"
    [@modalAnimation]
    class="fixed inset-0 bg-white dark:bg-gray-900 z-[100] flex flex-col md:hidden overflow-auto"
    (click)="$event.stopPropagation()">
  <!-- Header -->
  <div class="p-2 pt-4 flex items-center justify-between">
    <button (click)="toggleExpandedView($event)" [@buttonRotate] class="text-gray-900 dark:text-white pl-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <span class="text-gray-900 dark:text-white text-sm pr-4">{{'AUDIO_PLAYER.NOW_PLAYING' | translate}}</span>
    <div class="w-6"></div>
  </div>

  <!-- Album Art -->
  <div class="flex-1 flex flex-col items-center justify-center p-8 pt-4">
    <img [src]="song.imageUrl" (error)="handleImageError($event)" alt="Album cover" class="w-64 h-64 object-cover rounded-lg shadow-lg mb-8">
    <h3 class="text-gray-900 dark:text-white text-xl font-bold mb-2">{{song.title}}</h3>
    <p class="text-gray-500 dark:text-gray-400">{{song.artist}}</p>
  </div>

  <!-- Progress Bar -->
  <div class="px-8">
    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-2">
      <span>{{formatTime(currentTime)}}</span>
      <span>{{formatTime(duration)}}</span>
    </div>
    <input type="range"
          [value]="currentTime"
          [max]="duration"
          (input)="onSeek($event)"
          class="w-full accent-indigo-500 dark:accent-green-500">
  </div>

  <!-- Controls -->
  <div class="p-8 pb-16">
    <div class="flex items-center justify-between mb-8">
      <button (click)="toggleLoop($event)" [class]="getLoopButtonClass()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getLoopIconPath()" />
        </svg>
      </button>
      <button (click)="previous($event)" class="text-gray-500 dark:text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
        </svg>
      </button>
      <button (click)="rewind15($event)" class="text-gray-500 dark:text-gray-400">
        <svg viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
          <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
          <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
          <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M11.324 1.67511C11.4489 1.41526 11.7117 1.25 12 1.25C12.7353 1.25 13.4541 1.32394 14.1492 1.46503C19.0563 2.46112 22.75 6.79837 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12C1.25 7.59065 3.90459 3.80298 7.69972 2.14482C8.07929 1.97898 8.52143 2.15224 8.68726 2.53181C8.8531 2.91137 8.67984 3.35351 8.30028 3.51935C5.03179 4.94742 2.75 8.20808 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 7.84953 18.5158 4.33622 14.75 3.16544V4.5C14.75 4.81852 14.5488 5.10229 14.2483 5.20772C13.9477 5.31315 13.6133 5.21724 13.4143 4.96852L11.4143 2.46852C11.2342 2.24339 11.1991 1.93496 11.324 1.67511Z"/>
        </svg>
      </button>
      <button (click)="togglePlay($event)" class="text-gray-900 dark:text-white bg-indigo-500 dark:bg-green-500 hover:bg-indigo-600 dark:hover:bg-green-600 rounded-full p-4">
        <ng-container *ngIf="!isPlaying; else pauseIconLarge">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          </svg>
        </ng-container>
        <ng-template #pauseIconLarge>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6" />
          </svg>
        </ng-template>
      </button>
      <button (click)="forward15($event)" class="text-gray-500 dark:text-gray-400">
        <svg viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
          <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
          <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
          <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M12.676 1.67511C12.5511 1.41526 12.2883 1.25 12 1.25C11.2647 1.25 10.5459 1.32394 9.8508 1.46503C4.94367 2.46112 1.25 6.79837 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 7.59065 20.0954 3.80298 16.3003 2.14482C15.9207 1.97898 15.4786 2.15224 15.3127 2.53181C15.1469 2.91137 15.3202 3.35351 15.6997 3.51935C18.9682 4.94742 21.25 8.20808 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 7.84953 5.48421 4.33622 9.25 3.16544V4.5C9.25 4.81852 9.45118 5.10229 9.75175 5.20772C10.0523 5.31315 10.3867 5.21724 10.5857 4.96852L12.5857 2.46852C12.7658 2.24339 12.8009 1.93496 12.676 1.67511Z"/>
        </svg>
      </button>
      <button (click)="next($event)" class="text-gray-500 dark:text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
        </svg>
      </button>
      <button (click)="toggleMute($event)" class="text-gray-500 dark:text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path *ngIf="!isMuted" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
          <path *ngIf="isMuted" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
      </button>
    </div>
    <div class="flex items-center space-x-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
      </svg>
      <input type="range"
            [value]="volume * 100"
            (input)="onVolumeChange($event)"
            class="flex-1 accent-indigo-500 dark:accent-green-500">
      <button (click)="toggleLyrics()" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
        </svg>
      </button>
    </div>
  </div>
  <!-- Lyrics Section (Expandable) -->
  <div *ngIf="showLyrics" [@slideUpDown] class="container mx-auto mb-4 border-b border-gray-200 dark:border-gray-700 pb-4">
    <div class="flex justify-center">
      <div class="w-full max-w-2xl">
        <app-lyrics [song]="song" [currentTime]="currentTime"></app-lyrics>
      </div>
    </div>
  </div>
</div>

<!-- Desktop Player -->
<div class="hidden md:block fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-4 z-50">
  <!-- Lyrics Section (Expandable) -->
  <div *ngIf="showLyrics" [@slideUpDown] class="container mx-auto mb-4 border-b border-gray-200 dark:border-gray-700 pb-4">
    <div class="flex justify-center">
      <div class="w-full max-w-2xl">
        <app-lyrics [song]="song" [currentTime]="currentTime"></app-lyrics>
      </div>
    </div>
  </div>
  <div class="container mx-auto flex items-center justify-between">
    <div class="flex items-center flex-1">
      <img [src]="song.imageUrl" (error)="handleImageError($event)" alt="Album cover" class="w-16 h-16 object-cover rounded-md mr-4">
      <div>
        <h4 class="text-gray-900 dark:text-white font-semibold">{{song.title}}</h4>
        <p class="text-gray-500 dark:text-gray-400 text-sm">{{song.artist}}</p>
      </div>
    </div>

    <div class="flex-1 max-w-2xl">
      <div class="flex items-center justify-center space-x-6">
        <button (click)="toggleLyrics()" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
          </svg>
        </button>

        <button (click)="previous($event)" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
          </svg>
        </button>

        <button (click)="rewind15($event)" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
          <svg viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
            <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
            <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
            <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M11.324 1.67511C11.4489 1.41526 11.7117 1.25 12 1.25C12.7353 1.25 13.4541 1.32394 14.1492 1.46503C19.0563 2.46112 22.75 6.79837 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12C1.25 7.59065 3.90459 3.80298 7.69972 2.14482C8.07929 1.97898 8.52143 2.15224 8.68726 2.53181C8.8531 2.91137 8.67984 3.35351 8.30028 3.51935C5.03179 4.94742 2.75 8.20808 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 7.84953 18.5158 4.33622 14.75 3.16544V4.5C14.75 4.81852 14.5488 5.10229 14.2483 5.20772C13.9477 5.31315 13.6133 5.21724 13.4143 4.96852L11.4143 2.46852C11.2342 2.24339 11.1991 1.93496 11.324 1.67511Z"/>
          </svg>
        </button>

        <button (click)="togglePlay($event)" class="text-indigo-500 dark:text-green-500 hover:text-indigo-600 dark:hover:text-green-600">
          <ng-container *ngIf="!isPlaying; else pauseIcon">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </ng-container>
          <ng-template #pauseIcon>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </ng-template>
        </button>
        
        <button (click)="forward15($event)" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
          <svg viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
            <path d="M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403Z"/>
            <path d="M12.6746 8.60472C12.8447 8.09429 13.3224 7.75001 13.8604 7.75001H16.5C16.9142 7.75001 17.25 8.08579 17.25 8.50001C17.25 8.91422 16.9142 9.25001 16.5 9.25001H14.0406L13.5406 10.75H14.5C16.0188 10.75 17.25 11.9812 17.25 13.5C17.25 15.0188 16.0188 16.25 14.5 16.25H12.5C12.0858 16.25 11.75 15.9142 11.75 15.5C11.75 15.0858 12.0858 14.75 12.5 14.75H14.5C15.1904 14.75 15.75 14.1904 15.75 13.5C15.75 12.8097 15.1904 12.25 14.5 12.25H13.1937C12.3405 12.25 11.7381 11.4141 12.0079 10.6047L12.6746 8.60472Z"/>
            <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M12.676 1.67511C12.5511 1.41526 12.2883 1.25 12 1.25C11.2647 1.25 10.5459 1.32394 9.8508 1.46503C4.94367 2.46112 1.25 6.79837 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 7.59065 20.0954 3.80298 16.3003 2.14482C15.9207 1.97898 15.4786 2.15224 15.3127 2.53181C15.1469 2.91137 15.3202 3.35351 15.6997 3.51935C18.9682 4.94742 21.25 8.20808 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 7.84953 5.48421 4.33622 9.25 3.16544V4.5C9.25 4.81852 9.45118 5.10229 9.75175 5.20772C10.0523 5.31315 10.3867 5.21724 10.5857 4.96852L12.5857 2.46852C12.7658 2.24339 12.8009 1.93496 12.676 1.67511Z"/>
          </svg>
        </button>

        <button (click)="next($event)" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
          </svg>
        </button>

        <button (click)="toggleLoop($event)" [class]="getLoopButtonClass()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getLoopIconPath()" />
          </svg>
        </button>
      </div>

      <div class="mt-2 flex items-center">
        <span class="text-gray-500 dark:text-gray-400 text-sm w-12">{{formatTime(currentTime)}}</span>
        <div class="flex-1 mx-4">
          <input type="range"
                [value]="currentTime"
                [max]="duration"
                (input)="onSeek($event)"
                class="w-full accent-indigo-500 dark:accent-green-500">
        </div>
        <span class="text-gray-500 dark:text-gray-400 text-sm w-12">{{formatTime(duration)}}</span>
      </div>
    </div>
    <div class="flex-1 flex justify-end items-center">
      <button (click)="toggleMute($event)" class="text-gray-500 dark:text-gray-400 hover:text-indigo-500 dark:hover:text-green-500 mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path *ngIf="!isMuted" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
          <path *ngIf="isMuted" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
      </button>
      <input type="range"
            [value]="volume * 100"
            (input)="onVolumeChange($event)"
            class="w-24 accent-indigo-500 dark:accent-green-500">
    </div>
  </div>
</div>

<audio #audioPlayer
  [src]="song.filePath"
  (timeupdate)="onTimeUpdate()"
  (ended)="onEnded()"
  (loadedmetadata)="onLoadedMetadata()">
</audio>